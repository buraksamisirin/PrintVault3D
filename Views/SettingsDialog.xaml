<Window x:Class="PrintVault3D.Views.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ayarlar"
        Height="550" Width="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{StaticResource BackgroundDarkBrush}"
        WindowStyle="None"
        AllowsTransparency="True">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Border BorderBrush="{StaticResource BorderBrush}" 
            BorderThickness="1" 
            CornerRadius="12"
            Background="{StaticResource BackgroundDarkBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    CornerRadius="12,12,0,0"
                    Padding="20,16"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"
                              Fill="{StaticResource AccentCyanBrush}"
                              Width="24" Height="24"
                              Stretch="Uniform"
                              Margin="0,0,12,0"/>
                        <TextBlock Text="Ayarlar" 
                                   Style="{StaticResource SubHeaderText}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Style="{StaticResource IconButton}"
                            Command="{Binding CloseCommand}"
                            HorizontalAlignment="Right"
                            Width="32" Height="32">
                        <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                              Fill="{StaticResource TextSecondaryBrush}"
                              Width="14" Height="14"
                              Stretch="Uniform"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Content -->
            <ScrollViewer Grid.Row="1" Padding="24" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Watched Folders -->
                    <TextBlock Text="İZLENEN KLASÖRLER" 
                               Style="{StaticResource CaptionText}"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <Border Background="{StaticResource BackgroundMediumBrush}"
                            CornerRadius="8"
                            Padding="4"
                            Margin="0,0,0,8">
                        <ListBox ItemsSource="{Binding WatchedFolders}"
                                 SelectedItem="{Binding SelectedFolder}"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 MinHeight="100"
                                 MaxHeight="150">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource CategoryListItem}"/>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Path Data="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"
                                              Fill="{StaticResource AccentCyanBrush}"
                                              Width="16" Height="16"
                                              Stretch="Uniform"
                                              Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding}" 
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                        <Button Style="{StaticResource SecondaryButton}"
                                Command="{Binding AddWatchFolderCommand}"
                                Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
                                      Fill="{StaticResource AccentGreenBrush}"
                                      Width="14" Height="14"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0"/>
                                <TextBlock Text="Klasör Ekle"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource SecondaryButton}"
                                Command="{Binding RemoveWatchFolderCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19,13H5V11H19V13Z"
                                      Fill="{StaticResource AccentRedBrush}"
                                      Width="14" Height="14"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0"/>
                                <TextBlock Text="Seçili Klasörü Kaldır"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Filament Cost -->
                    <TextBlock Text="FİLAMENT MALİYETİ (KG BAŞINA)" 
                               Style="{StaticResource CaptionText}"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <Border Style="{StaticResource StatCard}" Margin="0,0,0,24">
                        <StackPanel>
                            <TextBlock Text="KG Başına Maliyet (Para Birimi)" Style="{StaticResource CaptionText}"/>
                            <Grid Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Text="{Binding FilamentCostPerKg, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}"
                                         Style="{StaticResource SearchTextBox}"/>
                            </Grid>
                            <TextBlock Text="Bu değer, G-code dosyalarındaki tahmini baskı maliyetini hesaplamak için kullanılır."
                                       Style="{StaticResource CaptionText}"
                                       Margin="0,4,0,0"
                                       Opacity="0.7"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Python Status -->
                    <TextBlock Text="PYTHON DURUMU" 
                               Style="{StaticResource CaptionText}"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <Border Style="{StaticResource StatCard}" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="{Binding PythonStatus}" 
                                           FontWeight="Medium"/>
                                <TextBlock Text="STL thumbnail oluşturma için Python gereklidir"
                                           Style="{StaticResource CaptionText}"
                                           Margin="0,4,0,0"/>
                            </StackPanel>
                            <Button Grid.Column="1"
                                    Style="{StaticResource SecondaryButton}"
                                    Command="{Binding InstallPythonDependenciesCommand}"
                                    Content="Paketleri Yükle"
                                    VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <!-- System Tray & Startup Settings -->
                    <TextBlock Text="SİSTEM TEPSİSİ VE BAŞLANGIÇ" 
                               Style="{StaticResource CaptionText}"
                               FontWeight="SemiBold"
                               Margin="0,24,0,12"/>

                    <Border Style="{StaticResource StatCard}" Margin="0,0,0,8">
                        <StackPanel>
                            <CheckBox Content="Küçültüldüğünde sistem tepsisine gönder"
                                      IsChecked="{Binding MinimizeToTray}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,12"/>
                            
                            <CheckBox Content="Windows ile birlikte başlat"
                                      IsChecked="{Binding StartWithWindows}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="0,0,0,12"/>
                            
                            <CheckBox Content="Başlangıçta küçültülmüş olarak başla"
                                      IsChecked="{Binding StartMinimized}"
                                      IsEnabled="{Binding StartWithWindows}"
                                      Foreground="{StaticResource TextPrimaryBrush}"
                                      Margin="16,0,0,12"/>
                            
                            <CheckBox Content="Yeni dosya algılandığında bildirim göster"
                                      IsChecked="{Binding ShowBalloonNotifications}"
                                      Foreground="{StaticResource TextPrimaryBrush}"/>
                        </StackPanel>
                    </Border>

                    <!-- Paths -->
                    <TextBlock Text="DEPOLAMA YOLLARI" 
                               Style="{StaticResource CaptionText}"
                               FontWeight="SemiBold"
                               Margin="0,24,0,12"/>

                    <Border Style="{StaticResource StatCard}" Margin="0,0,0,8">
                        <StackPanel>
                            <TextBlock Text="Vault Klasörü" Style="{StaticResource CaptionText}"/>
                            <Grid Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding VaultPath}" 
                                           TextTrimming="CharacterEllipsis"
                                           ToolTip="{Binding VaultPath}"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <Button Grid.Column="1"
                                        Style="{StaticResource IconButton}"
                                        Command="{Binding OpenVaultFolderCommand}"
                                        ToolTip="Klasörü Aç">
                                    <Path Data="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"
                                          Fill="{StaticResource TextSecondaryBrush}"
                                          Width="14" Height="14"
                                          Stretch="Uniform"/>
                                </Button>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource StatCard}" Margin="0,0,0,8">
                        <StackPanel>
                            <TextBlock Text="Veritabanı" Style="{StaticResource CaptionText}"/>
                            <TextBlock Text="{Binding DatabasePath}" 
                                       TextTrimming="CharacterEllipsis"
                                       ToolTip="{Binding DatabasePath}"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,12"/>
                            <Button Style="{StaticResource SecondaryButton}"
                                    Command="{Binding ClearAllDataCommand}"
                                    HorizontalAlignment="Stretch"
                                    Background="#E53935"
                                    Foreground="White"
                                    Padding="12,8">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                          Fill="White"
                                          Width="16" Height="16"
                                          Stretch="Uniform"
                                          Margin="0,0,8,0"/>
                                    <TextBlock Text="Tüm Verileri Temizle"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <Border Style="{StaticResource StatCard}">
                        <StackPanel>
                            <TextBlock Text="Ayar Dosyası" Style="{StaticResource CaptionText}"/>
                            <TextBlock Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"
                                       TextTrimming="CharacterEllipsis">
                                <TextBlock.Text>
                                    <Binding Path="VaultPath" StringFormat="{}{0}\..\AppSettings.json"/>
                                </TextBlock.Text>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundMediumBrush}"
                    CornerRadius="0,0,12,12"
                    Padding="24,16">
                <Button Style="{StaticResource PrimaryButton}"
                        Command="{Binding CloseCommand}"
                        Content="Kapat"
                        HorizontalAlignment="Right"/>
            </Border>
        </Grid>
    </Border>
</Window>


