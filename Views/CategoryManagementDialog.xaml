<Window x:Class="PrintVault3D.Views.CategoryManagementDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Kategori Yönetimi"
        Height="550" Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{StaticResource BackgroundDarkBrush}"
        WindowStyle="None"
        AllowsTransparency="True">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Border BorderBrush="{StaticResource BorderBrush}" 
            BorderThickness="1" 
            CornerRadius="12"
            Background="{StaticResource BackgroundDarkBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BackgroundMediumBrush}"
                    CornerRadius="12,12,0,0"
                    Padding="20,16"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"
                              Fill="{StaticResource AccentPurpleBrush}"
                              Width="24" Height="24"
                              Stretch="Uniform"
                              Margin="0,0,12,0"/>
                        <TextBlock Text="Kategori Yönetimi" 
                                   Style="{StaticResource SubHeaderText}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Button Style="{StaticResource IconButton}"
                            Command="{Binding CloseCommand}"
                            HorizontalAlignment="Right"
                            Width="32" Height="32">
                        <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                              Fill="{StaticResource TextSecondaryBrush}"
                              Width="14" Height="14"
                              Stretch="Uniform"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="24">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Add New Category -->
                <Border Grid.Row="0" 
                        Background="{StaticResource BackgroundMediumBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Margin="0,0,0,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding NewCategoryName, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SearchTextBox}"
                                 Margin="0,0,8,0"
                                 Tag="Kategori adı..."/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding NewCategoryKeywords, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource SearchTextBox}"
                                 Margin="0,0,8,0"
                                 Tag="Anahtar kelimeler (virgülle)..."/>
                        <Button Grid.Column="2"
                                Style="{StaticResource PrimaryButton}"
                                Command="{Binding AddCategoryCommand}"
                                Padding="16,10">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"
                                      Fill="{StaticResource BackgroundDarkBrush}"
                                      Width="14" Height="14"
                                      Stretch="Uniform"
                                      Margin="0,0,6,0"/>
                                <TextBlock Text="Ekle"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>

                <!-- Categories List -->
                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Categories}"
                         SelectedItem="{Binding SelectedCategory}"
                         Background="Transparent"
                         BorderThickness="0">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="border"
                                                Background="{StaticResource BackgroundMediumBrush}"
                                                CornerRadius="8"
                                                Padding="16,12"
                                                Margin="0,0,0,8"
                                                Cursor="Hand">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentCyanBrush}"/>
                                                <Setter TargetName="border" Property="BorderThickness" Value="2"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundLightBrush}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Ellipse Grid.Column="0" 
                                         Width="10" Height="10" 
                                         Fill="{StaticResource AccentCyanBrush}"
                                         Margin="0,0,12,0"
                                         VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding Category.Name}" 
                                               FontWeight="Medium"
                                               FontSize="14"/>
                                    <TextBlock Text="{Binding Category.AutoKeywords}" 
                                               Style="{StaticResource CaptionText}"
                                               TextTrimming="CharacterEllipsis"
                                               Visibility="{Binding Category.AutoKeywords, Converter={StaticResource BoolToVis}}"
                                               Margin="0,2,0,0"/>
                                </StackPanel>

                                <Border Grid.Column="2"
                                        Background="{StaticResource BackgroundDarkBrush}"
                                        CornerRadius="12"
                                        Padding="10,4"
                                        VerticalAlignment="Center">
                                    <TextBlock>
                                        <Run Text="{Binding ModelCount, Mode=OneWay}"/>
                                        <Run Text="model" Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </TextBlock>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Edit Panel -->
                <Border Grid.Row="2" 
                        Background="{StaticResource BackgroundMediumBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Margin="0,8,0,0"
                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}">
                    <StackPanel>
                        <TextBlock Text="KATEGORİ DÜZENLE" 
                                   Style="{StaticResource CaptionText}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBlock Text="Ad" Style="{StaticResource CaptionText}" Margin="0,0,0,4"/>
                                <TextBox Text="{Binding EditName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource SearchTextBox}"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                <TextBlock Text="Anahtar Kelimeler" Style="{StaticResource CaptionText}" Margin="0,0,0,4"/>
                                <TextBox Text="{Binding EditKeywords, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource SearchTextBox}"/>
                            </StackPanel>
                        </Grid>
                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0" HorizontalAlignment="Right">
                            <Button Style="{StaticResource SecondaryButton}"
                                    Command="{Binding CancelEditCommand}"
                                    Content="İptal"
                                    Margin="0,0,8,0"/>
                            <Button Style="{StaticResource PrimaryButton}"
                                    Command="{Binding SaveEditCommand}"
                                    Content="Kaydet"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Footer -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundMediumBrush}"
                    CornerRadius="0,0,12,12"
                    Padding="24,16">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <Button Style="{StaticResource SecondaryButton}"
                                Command="{Binding StartEditCommand}"
                                Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                      Fill="{StaticResource TextSecondaryBrush}"
                                      Width="14" Height="14"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0"/>
                                <TextBlock Text="Düzenle"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource SecondaryButton}"
                                Command="{Binding DeleteCategoryCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
                                      Fill="{StaticResource AccentRedBrush}"
                                      Width="14" Height="14"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0"/>
                                <TextBlock Text="Sil"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <Button Style="{StaticResource PrimaryButton}"
                            Command="{Binding CloseCommand}"
                            Content="Kapat"
                            HorizontalAlignment="Right"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>


